/*
FloraJS
Copyright (C) 2012 Vince Allen
Brooklyn, NY 11215, USA

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
*/
/* Version: 0.0.2 */
/* Simplex noise by Sean McCullough banksean@gmail.com */
/* Build time: November 4, 2012 05:24:34 */
var Flora={},exports=Flora;
(function(b){function p(){this._records=[]}function y(){}function j(a,c){this.x=a||0;this.y=c||0}function v(){this._gradients=[];this._colors=[]}function A(){}function B(){this._borders=[]}function k(a){var c=this,a=a||{};this.isPlaying=a.isPlaying||!0;this.zSorted=!!a.zSorted;this.showStats=!!a.showStats;this.isDeviceMotion=!!a.isDeviceMotion;this._records=[];this._statsDisplay=null;b.Utils.addEvent(document.body,"mousemove",function(a){b.mouse.locLast=b.mouse.loc.clone();a.pageX&&a.pageY?b.mouse.loc=
new b.Vector(a.pageX,a.pageY):a.clientX&&a.clientY&&(b.mouse.loc=new b.Vector(a.clientX,a.clientY))});b.Utils.addEvent(document,"keyup",function(a){a.keyCode===b.config.keyMap.pause?c.pauseSystem():a.keyCode===b.config.keyMap.reset?c.resetSystem():a.keyCode===b.config.keyMap.stats&&c.toggleStats()});b.Utils.addEvent(document,"touchstart",function(a){a=a.touches;2===a.length?c.toggleStats():3===a.length?c.pauseSystem():4===a.length&&c.resetSystem()});b.Utils.addEvent(document.body,"keydown",function(a){var c,
f=b.elementList.all(),g,h,i,m;switch(a.keyCode){case b.config.keyMap.thrustLeft:a=0;for(c=f.length;a<c;a++)f[a].keyControl&&(g=f[a],i=g.world.width/2,m=b.Utils.degreesToRadians(g.angle-g.turningRadius),h=i*Math.cos(m),i*=Math.sin(m),h=b.Vector.VectorAdd(new b.Vector(h,i),g.location),h=b.Vector.VectorSub(h,g.location),h.normalize(),h.mult(2*g.velocity.mag()),h=b.Vector.VectorSub(h,g.velocity),g.applyForce(h));break;case b.config.keyMap.thrustUp:a=0;for(c=f.length;a<c;a++)f[a].keyControl&&(g=f[a],i=
g.world.width/2,m=b.Utils.degreesToRadians(g.angle),h=i*Math.cos(m),i*=Math.sin(m),h=new b.Vector(h,i),h.normalize(),h.mult(g.thrust),h.limit(g.maxSpeed),f[a].applyForce(h));break;case b.config.keyMap.thrustRight:a=0;for(c=f.length;a<c;a++)f[a].keyControl&&(g=f[a],i=g.world.width/2,m=b.Utils.degreesToRadians(g.angle+g.turningRadius),h=i*Math.cos(m),i*=Math.sin(m),h=b.Vector.VectorAdd(new b.Vector(h,i),g.location),h=b.Vector.VectorSub(h,g.location),h.normalize(),h.mult(2*g.velocity.mag()),h=b.Vector.VectorSub(h,
g.velocity),f[a].applyForce(h));break;case b.config.keyMap.thrustDown:a=0;for(c=f.length;a<c;a++)f[a].keyControl&&f[a].velocity.mult(0.5)}});b.System.supportedFeatures.touch&&this.isDeviceMotion&&this.addDeviceMotionEventListener();this.showStats&&this.createStats()}function s(a){var c=this,a=a||{},e=b.Utils.getWindowSize();this.isStatic=a.isStatic||!0;this.clock=a.clock||0;this.c=a.c||0.01;this.gravity=a.gravity||new b.Vector(0,1);this.wind=a.wind||new b.Vector;this.location=a.location||new b.Vector;
this.scale=a.scale||1;this.angle=a.angle||0;this.opacity=a.opacity||1;this.colorMode=a.colorMode||"rgb";this.color=a.color||[0,0,0];this.borderWidth=a.borderWidth||0;this.borderStyle=a.borderStyle||"none";this.borderColor=a.borderColor||null;this.borderRadius=a.borderRadius||0;this.boxShadow=a.boxShadow||0;this.zIndex=0;this.beforeStep=a.beforeStep||void 0;this.afterStep=a.afterStep||void 0;a.el?(this.el=a.el,this.id=this.el.id,this.width=this.el.offsetWidth,this.height=this.el.offsetHeight):(this.el=
document.body,this.width=e.width,this.height=e.height,this.id=s.name+"-"+s._idCount);this.el.className="world floraElement";this.el.style.width=this.width+"px";this.el.style.height=this.height+"px";s._idCount+=1;b.Utils.addEvent(window,"resize",function(){c.resize.call(c)})}function W(a){a=a||{};this.location=a.location||new b.Vector(0,0);this.controlObj=a.controlObj||null}function n(a){var c,e,d,f;c=0;for(e=arguments.length;c<e;c+=1)for(d in f=arguments[c],f)f.hasOwnProperty(d)&&(this[d]=f[d]);c=
a||{};e=b.elementList.all()||[];d=b.liquids||[];f=b.repellers||[];var g=b.attractors||[],h=b.heats||[],i=b.colds||[],m=b.predators||[],j=b.lights||[],r=b.oxygen||[],q=b.food||[],o,k=this.name||"anon";this.id=c.id||k.toLowerCase()+"-"+n._idCount;this.el=c.view&&"function"===b.Interface.getDataType(c.view)?c.view.apply(this,c.viewArgs):"object"===b.Interface.getDataType(c.view)?c.view:document.createElement("div");o=this.world=c.world||b.universe.first();this.location=c.location||new b.Vector(o.width/
2,o.height/2);this.acceleration=c.acceleration||new b.Vector;this.velocity=c.velocity||new b.Vector;this.width=0===c.width?0:c.width||20;this.height=0===c.height?0:c.height||20;this.scale=0===c.scale?0:c.scale||1;this.angle=c.angle||0;this.opacity=0===c.opacity?0:c.opacity||0.85;this.colorMode=c.colorMode||"rgb";this.color=c.color||null;this.zIndex=0===c.zIndex?0:c.zIndex||1;this.borderWidth=c.borderWidth||null;this.borderStyle=c.borderStyle||null;this.borderColor=c.borderColor||null;this.borderRadius=
c.borderRadius||null;this.boxShadow=c.boxShadow||null;this.sensors=c.sensors||[];this.className=c.className||k.toLowerCase();this.className+=" floraElement";e.push(this);this.el.id=this.id;this.el.className=0<this.sensors.length?this.className+" hasSensor":this.className;this.el.style.display="none";o.el&&o.el.appendChild(this.el);n._idCount+=1;-1!==this.className.search("liquid")?d.push(this):-1!==this.className.search("repeller")?f.push(this):-1!==this.className.search("attractor")?g.push(this):
-1!==this.className.search("heat")?h.push(this):-1!==this.className.search("cold")?i.push(this):-1!==this.className.search("predator")?m.push(this):-1!==this.className.search("light")?j.push(this):-1!==this.className.search("oxygen")?r.push(this):-1!==this.className.search("food")&&q.push(this);if(this.controlCamera=!!c.controlCamera)b.camera.controlObj=this,o.location.x=-o.width/2+b.Utils.getWindowSize().width/2+(o.width/2-this.location.x),o.location.y=-o.height/2+b.Utils.getWindowSize().height/
2+(o.height/2-this.location.y)}function l(a){a=a||{};b.Element.call(this,a);this.mass=a.mass||10;this.maxSpeed=0===a.maxSpeed?0:a.maxSpeed||10;this.minSpeed=a.minSpeed||0;this.motorSpeed=a.motorSpeed||0;this.lifespan=0===a.lifespan?0:a.lifespan||-1;this.offsetDistance=0===a.offsetDistance?0:a.offsetDistance||30;this.offsetAngle=a.offsetAngle||0;this.pointToDirection=!1===a.pointToDirection?!1:a.pointToDirection||!0;this.followMouse=!!a.followMouse;this.seekTarget=a.seekTarget||null;this.followTarget=
a.followTarget||null;this.isStatic=!!a.isStatic;this.draggable=!!a.draggable;this.checkEdges=!1===a.checkEdges?!1:a.checkEdges||!0;this.wrapEdges=!!a.wrapEdges;this.avoidEdges=!!a.avoidEdges;this.avoidEdgesStrength=0===a.avoidEdgesStrength?0:a.avoidEdgesStrength||200;this.bounciness=0===a.bounciness?0:a.bounciness||0.75;this.maxSteeringForce=0===a.maxSteeringForce?0:a.maxSteeringForce||100;this.turningRadius=0===a.turningRadius?0:a.turningRadius||90;this.thrust=0===a.thrust?0:a.thrust||5;this.flocking=
!!a.flocking;this.desiredSeparation=0===a.desiredSeparation?0:a.desiredSeparation||2*this.width;this.separateStrength=0===a.separateStrength?0:a.separateStrength||0.3;this.alignStrength=0===a.alignStrength?0:a.alignStrength||0.2;this.cohesionStrength=0===a.cohesionStrength?0:a.cohesionStrength||0.1;this.flowField=a.flowField||null;this.beforeStep=a.beforeStep||void 0;this.afterStep=a.afterStep||void 0;this.draggable&&(b.Utils.addEvent(this.el,"mouseover",b.Element.mouseover.bind(this)),b.Utils.addEvent(this.el,
"mousedown",b.Element.mousedown.bind(this)),b.Utils.addEvent(this.el,"mousemove",b.Element.mousemove.bind(this)),b.Utils.addEvent(this.el,"mouseup",b.Element.mouseup.bind(this)),b.Utils.addEvent(this.el,"mouseout",b.Element.mouseout.bind(this)))}function C(a){a=a||{};b.Agent.call(this,a);this.isPerlin=!1===a.isPerlin?!1:a.isPerlin||!0;this.remainsOnScreen=!!a.remainsOnScreen;this.perlinSpeed=a.perlinSpeed||0.0050;this.perlinTime=a.perlinTime||0;this.perlinAccelLow=a.perlinAccelLow||-0.075;this.perlinAccelHigh=
a.perlinAccelHigh||0.075;this.offsetX=a.offsetX||1E4*Math.random();this.offsetY=a.offsetY||1E4*Math.random();this.isRandom=!!a.isRandom;this.randomRadius=a.randomRadius||100;this.isHarmonic=!!a.isHarmonic;this.harmonicAmplitude=a.harmonicAmplitude||new b.Vector(4,0);this.harmonicPeriod=a.harmonicPeriod||new b.Vector(300,1);this.width=0===a.width?0:a.width||10;this.height=0===a.height?0:a.height||10;this.maxSpeed=0===a.maxSpeed?0:a.maxSpeed||30;this.wrapEdges=!!a.wrapEdges;this.isStatic=!!a.isStatic}
function D(a){a=a||{};b.Agent.call(this,a);this.initialLocation=a.initialLocation||new b.Vector(this.world.width/2,this.world.height/2);this.lastLocation=new b.Vector(0,0);this.width=0===a.width?0:a.width||10;this.height=0===a.height?0:a.height||10;this.amplitude=a.amplitude||new b.Vector(this.world.width/2-this.width,this.world.height/2-this.height);this.acceleration=a.acceleration||new b.Vector(0.01,0);this.aVelocity=new b.Vector(0,0);this.isStatic=!!a.isStatic;this.isPerlin=!!a.isPerlin;this.perlinSpeed=
a.perlinSpeed||0.0050;this.perlinTime=a.perlinTime||0;this.perlinAccelLow=a.perlinAccelLow||-2;this.perlinAccelHigh=a.perlinAccelHigh||2;this.perlinOffsetX=a.perlinOffsetX||1E4*Math.random();this.perlinOffsetY=a.perlinOffsetY||1E4*Math.random()}function E(a){a=a||{};b.Agent.call(this,a);this.lifespan=a.lifespan||40;this.borderRadius=a.borderRadius||"100%"}function H(a){var a=a||{},c=b.defaultColors.getColor("heat"),e=b.defaultColors.getColor("food"),d=new b.ColorPalette;b.Agent.call(this,a);d.addColor({min:12,
max:24,startColor:c.startColor,endColor:c.endColor}).addColor({min:12,max:24,startColor:e.startColor,endColor:e.endColor});this.beforeStep=function(){var a;if(0===this.world.clock%this.burstRate)for(a=0;a<this.burst;a+=1)new b.Particle(this.particle());0<this.lifespan?this.lifespan-=1:0===this.lifespan&&b.elementList.destroyElement(this.id)};this.lifespan=a.lifespan||-1;this.width=0===a.width?0:a.width||0;this.height=0===a.height?0:a.height||0;this.isStatic=!1===a.isStatic?!1:a.isStatic||!0;this.burst=
0===a.burst?0:a.burst||1;this.burstRate=0===a.burstRate?0:a.burstRate||3;this.particle=a.particle||function(){var a=b.config.borderStyles,a=a[b.Utils.getRandomNumber(0,a.length-1)];return{color:d.getColor(),borderWidth:b.Utils.getRandomNumber(2,12),borderStyle:a,borderColor:d.getColor(),boxShadow:"0 0 0 "+b.Utils.getRandomNumber(2,6)+"px rgb("+d.getColor().toString()+")",zIndex:b.Utils.getRandomNumber(1,100),location:this.getLocation(),acceleration:new b.Vector(b.Utils.getRandomNumber(-4,4),b.Utils.getRandomNumber(-4,
4))}}}function I(a){a=a||{};b.Agent.call(this,a);this.c=0===a.c?0:a.c||1;this.mass=0===a.mass?0:a.mass||50;this.isStatic=!1===a.isStatic?!1:a.isStatic||!0;this.width=0===a.width?0:a.width||100;this.height=0===a.height?0:a.height||100;this.opacity=0===a.opacity?0:a.opacity||0.75;this.zIndex=0===a.zIndex?0:a.zIndex||10}function J(a){a=a||{};b.Agent.call(this,a);this.G=0===a.G?0:a.G||10;this.mass=0===a.mass?0:a.mass||100;this.isStatic=!1===a.isStatic?!1:a.isStatic||!0;this.width=0===a.width?0:a.width||
100;this.height=0===a.height?0:a.height||100;this.opacity=0===a.opacity?0:a.opacity||0.75;this.zIndex=0===a.zIndex?0:a.zIndex||10}function K(a){a=a||{};b.Agent.call(this,a);this.G=0===a.G?0:a.G||-10;this.mass=0===a.mass?0:a.mass||100;this.isStatic=!1===a.isStatic?!1:a.isStatic||!0;this.width=0===a.width?0:a.width||100;this.height=0===a.height?0:a.height||100;this.opacity=0===a.opacity?0:a.opacity||0.75;this.zIndex=0===a.zIndex?0:a.zIndex||10}function L(a){a=a||{};b.Agent.call(this,a);this.mass=0===
a.mass?0:a.mass||50;this.isStatic=!1===a.isStatic?!1:a.isStatic||!0;this.width=0===a.width?0:a.width||50;this.height=0===a.height?0:a.height||50;this.opacity=0===a.opacity?0:a.opacity||0.75;this.zIndex=0===a.zIndex?0:a.zIndex||10}function M(a){a=a||{};b.Agent.call(this,a);this.mass=0===a.mass?0:a.mass||50;this.isStatic=!1===a.isStatic?!1:a.isStatic||!0;this.width=0===a.width?0:a.width||50;this.height=0===a.height?0:a.height||50;this.opacity=0===a.opacity?0:a.opacity||0.75;this.zIndex=0===a.zIndex?
0:a.zIndex||10}function N(a){a=a||{};b.Agent.call(this,a);this.mass=0===a.mass?0:a.mass||50;this.isStatic=!1===a.isStatic?!1:a.isStatic||!0;this.width=0===a.width?0:a.width||50;this.height=0===a.height?0:a.height||50;this.opacity=0===a.opacity?0:a.opacity||0.85;this.zIndex=0===a.zIndex?0:a.zIndex||10}function O(a){a=a||{};b.Agent.call(this,a);this.mass=0===a.mass?0:a.mass||50;this.isStatic=!1===a.isStatic?!1:a.isStatic||!0;this.width=0===a.width?0:a.width||50;this.height=0===a.height?0:a.height||
50;this.opacity=0===a.opacity?0:a.opacity||0.75;this.zIndex=0===a.zIndex?0:a.zIndex||10}function P(a){a=a||{};b.Agent.call(this,a);this.mass=0===a.mass?0:a.mass||50;this.isStatic=!1===a.isStatic?!1:a.isStatic||!0;this.width=0===a.width?0:a.width||50;this.height=0===a.height?0:a.height||50;this.opacity=0===a.opacity?0:a.opacity||0.75;this.zIndex=0===a.zIndex?0:a.zIndex||10}function Q(a){a=a||{};b.Agent.call(this,a);this.mass=0===a.mass?0:a.mass||50;this.isStatic=!1===a.isStatic?!1:a.isStatic||!0;this.width=
0===a.width?0:a.width||75;this.height=0===a.height?0:a.height||75;this.opacity=0===a.opacity?0:a.opacity||0.75;this.zIndex=0===a.zIndex?0:a.zIndex||10}function w(a){a=a||{};b.Agent.call(this,a);this.type=a.type||"";this.behavior=a.behavior||"LOVE";this.sensitivity=0===a.sensitivity?0:a.sensitivity||2;this.width=0===a.width?0:a.width||7;this.height=0===a.height?0:a.height||7;this.offsetDistance=0===a.offsetDistance?0:a.offsetDistance||30;this.offsetAngle=a.offsetAngle||0;this.opacity=0===a.opacity?
0:a.opacity||0.75;this.target=a.target||null;this.activated=!!a.activated;this.activatedColor=a.activatedColor||[200,200,200]}function X(a){var c,e;if(b.Interface.checkRequiredParams(a,{location:"object",scale:"number",angle:"number",opacity:"number",width:"number",height:"number",colorMode:"string",color:"array"}))return c=document.createElement("div"),e=document.createElement("div"),c.className="flowFieldMarker floraElement",e.className="nose",c.appendChild(e),c.style.cssText=b.Utils.getCSSText({x:a.location.x-
a.width/2,y:a.location.y-a.height/2,s:a.scale,a:a.angle,o:a.opacity,w:a.width,h:a.height,cm:a.colorMode,color:a.color,z:a.zIndex,borderWidth:a.borderWidth,borderStyle:a.borderStyle,borderColor:a.borderColor,borderRadius:a.borderRadius,boxShadow:a.boxShadow}),c}function R(a){a=a||{};this.resolution=a.resolution||50;this.perlinSpeed=a.perlinSpeed||0.01;this.perlinTime=a.perlinTime||100;this.field=a.field||null;this.createMarkers=a.createMarkers||!1;this.world=a.world||b.universe.first()}function F(a,
c,e){e=e||{};b.Agent.call(this,e);if(!a||!c)throw Error("Connector: both parentA and parentB are required.");this.parentA=a;this.parentB=c;this.height=this.width=0;this.color="transparent";this.opacity=0===e.opacity?0:e.opacity||1;this.zIndex=e.zIndex||0}function S(a){a=a||{};b.Agent.call(this,a);this.width=0===a.width?0:a.width||10;this.height=0===a.height?0:a.height||10;this.opacity=0===a.opacity?0:a.opacity||0.5;this.isStatic=!1===a.isStatic?!1:a.isStatic||!0;this.zIndex=0===a.zIndex?0:a.zIndex||
0;this.offsetAngle=a.offsetAngle||0;this.length=0===a.length?0:a.length||30}function T(a){a=a||{};this.world=a.world||b.universe.first();this.position=a.position||"top left";this.text=a.text||"";this.opacity=0===a.opacity?0:a.opacity||0.75;this.color=a.color||[255,255,255];this.borderWidth=a.borderWidth||"1px";this.borderStyle=a.borderStyle||"solid";this.borderColor=a.borderColor||[204,204,204];this.colorMode=a.colorMode||"rgb";this._el=document.createElement("div");this._el.id="caption";this._el.className=
"caption "+this.position;this._el.style.opacity=this.opacity;this._el.style.color=this.colorMode+"("+this.color[0]+", "+this.color[1]+", "+this.color[2]+")";this._el.style.borderWidth=this.borderWidth;this._el.style.borderStyle=this.borderStyle;this._el.style.borderColor="string"===typeof this.borderColor?this.borderColor:this.colorMode+"("+this.borderColor[0]+", "+this.borderColor[1]+", "+this.borderColor[2]+")";this._el.appendChild(document.createTextNode(this.text));document.getElementById("caption")&&
document.getElementById("caption").parentNode.removeChild(document.getElementById("caption"));this.world.el.appendChild(this._el)}function U(a){var c=this,a=a||{};this.world=a.world||b.universe.first();this.position=a.position||"top left";this.opacity=0===a.opacity?0:a.opacity||0.75;this.color=a.color||[255,255,255];this.borderWidth=a.borderWidth||"1px";this.borderStyle=a.borderStyle||"solid";this.borderColor=a.borderColor||[204,204,204];this.colorMode=a.colorMode||"rgb";this.text=b.System.supportedFeatures.touch?
b.config.touchMap.stats+"-finger tap = stats | "+b.config.touchMap.pause+"-finger tap = pause | "+b.config.touchMap.reset+"-finger tap = reset":"'"+String.fromCharCode(b.config.keyMap.pause).toLowerCase()+"' = pause | '"+String.fromCharCode(b.config.keyMap.reset).toLowerCase()+"' = reset | '"+String.fromCharCode(b.config.keyMap.stats).toLowerCase()+"' = stats";this._el=document.createElement("div");this._el.id="inputMenu";this._el.className="inputMenu "+this.position;this._el.style.opacity=this.opacity;
this._el.style.color=this.colorMode+"("+this.color[0]+", "+this.color[1]+", "+this.color[2]+")";this._el.style.borderWidth=this.borderWidth;this._el.style.borderStyle=this.borderStyle;this._el.style.borderColor="string"===typeof this.borderColor?this.borderColor:this.colorMode+"("+this.borderColor[0]+", "+this.borderColor[1]+", "+this.borderColor[2]+")";this._el.appendChild(document.createTextNode(this.text));document.getElementById("inputMenu")&&document.getElementById("inputMenu").parentNode.removeChild(document.getElementById("inputMenu"));
b.System.supportedFeatures.touch?b.Utils.addEvent(this._el,"touchstart",function(){c.destroy()}):b.Utils.addEvent(this._el,"mouseup",function(){c.destroy()});this.world.el.appendChild(this._el)}function G(){var a,c;this._fps=0;this._timeLastSecond=this._timeLastFrame=this._time=Date.now?Date.now():0;this._frameCount=0;this._el=document.createElement("div");this._el.id="statsDisplay";this._el.className="statsDisplay";this._el.style.color="white";this._fpsValue=this._totalElementsValue=null;a=document.createElement("span");
a.className="statsDisplayLabel";c=document.createTextNode("total elements: ");a.appendChild(c);this._el.appendChild(a);this._totalElementsValue=document.createTextNode("0");this._el.appendChild(this._totalElementsValue);a=document.createElement("span");a.className="statsDisplayLabel";c=document.createTextNode("fps: ");a.appendChild(c);this._el.appendChild(a);this._fpsValue=document.createTextNode("0");this._el.appendChild(this._fpsValue);document.body.appendChild(this._el);this._update()}function x(){}
window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)};b.config={borderStyles:"none solid dotted dashed double inset outset groove ridge".split(" "),defaultColorList:[{name:"heat",startColor:[255,132,86],endColor:[175,47,0]},{name:"cold",startColor:[88,129,135],endColor:[171,244,255]},{name:"food",startColor:[186,255,130],endColor:[84,
187,0]},{name:"oxygen",startColor:[109,215,255],endColor:[0,140,192]},{name:"light",startColor:[255,227,127],endColor:[189,148,0]}],keyMap:{pause:80,reset:82,stats:83,thrustLeft:37,thrustUp:38,thrustRight:39,thrustDown:40},touchMap:{stats:2,pause:3,reset:4}};p.prototype.name="ElementList";p.prototype.add=function(a){this._records.push(a);return this._records};p.prototype.all=function(){return this._records};p.prototype.count=function(){return this._records.length};p.prototype.getAllByName=function(a){var c,
b,d=[];c=0;for(b=this._records.length;c<b;c++)this._records[c].name===a&&(d[d.length]=this._records[c]);return d};p.prototype.updatePropsByName=function(a,c){var b,d,f,g=this.getAllByName(a);b=0;for(d=g.length;b<d;b++)for(f in c)c.hasOwnProperty(f)&&(g[b][f]=c[f]);return g};p.prototype.getElement=function(a){var c,b,d=this._records;c=0;for(b=d.length;c<b;c+=1)if(d[c].id===a)return d[c]};p.prototype.destroyElement=function(a){var c,b,d=this._records;c=0;for(b=d.length;c<b;c+=1)if(d[c].id===a){d[c].world.el.removeChild(d[c].el);
d.splice(c,1);break}};p.prototype.destroyAll=function(){var a,c=this._records;for(a=c.length-1;0<=a;a-=1)c[a].world&&c[a].world.el.removeChild(c[a].el);this._records=[]};p.prototype.destroyByWorld=function(a){var c,b=this._records;for(c=b.length-1;0<=c;c-=1)b[c].world&&b[c].world===a&&(b[c].world.el.removeChild(b[c].el),b.splice(c,1))};b.ElementList=p;y.name="System";y.setup=null;y.start=function(a,c,e){var d=b.config.defaultColorList;this.universeOptions=c||null;this.worlds=e||null;this._featureDetector=
new b.FeatureDetector;this.supportedFeatures={};this.supportedFeatures.csstransforms=this._featureDetector.detect("csstransforms");this.supportedFeatures.csstransforms3d=this._featureDetector.detect("csstransforms3d");this.supportedFeatures.touch=this._featureDetector.detect("touch");b.liquids=[];b.repellers=[];b.attractors=[];b.heats=[];b.colds=[];b.lights=[];b.oxygen=[];b.food=[];b.predators=[];b.mouse={loc:new b.Vector,locLast:new b.Vector};b.elementList=new b.ElementList;b.universe=new b.Universe(this.universeOptions);
if("array"===b.Interface.getDataType(this.worlds)){c=0;for(e=this.worlds.length;c<e;c+=1)b.universe.addWorld({el:this.worlds[c]})}else b.universe.addWorld();b.camera=new b.Camera;b.defaultColors=new b.ColorTable;c=0;for(e=d.length;c<e;c++)b.defaultColors.addColor({name:d[c].name,startColor:d[c].startColor,endColor:d[c].endColor});b.animLoop=function(){var a;a=b.universe;a.first();var c=b.elementList.all();if(a.isPlaying){window.requestAnimFrame(b.animLoop);a.zSorted&&(c=c.sort(function(a,c){return c.zIndex-
a.zIndex}));for(a=c.length-1;0<=a;a-=1)c[a].step(),c[a]&&c[a].draw();b.universe.updateClocks()}};a="function"===b.Interface.getDataType(a)?a:function(){};y.setup=a;a();b.animLoop()};y.destroy=function(){b.elementList.destroyAll()};b.System=y;b.Utils={extend:function(a,c){function b(){}b.prototype=c.prototype;a.prototype=new b;a.prototype.constructor=a},map:function(a,c,b,d,f){return(a-c)/(b-c)*(f-d)+d},getRandomNumber:function(a,c,b){return b?Math.random()*(c-(a-1))+a:Math.floor(Math.random()*(c-
(a-1)))+a},degreesToRadians:function(a){if("undefined"!==typeof a)return 2*Math.PI*(a/360);"undefined"!==typeof console&&console.log("Error: Utils.degreesToRadians is missing degrees param.");return!1},radiansToDegrees:function(a){if("undefined"!==typeof a)return a*(180/Math.PI);"undefined"!==typeof console&&console.log("Error: Utils.radiansToDegrees is missing radians param.");return!1},constrain:function(a,c,b){return a>b?b:a<c?c:a},clone:function(a){function c(){}c.prototype=a;return new c},addEvent:function(a,
c,b){a.addEventListener?this.addEventHandler=function(a,c,b){a.addEventListener(c,b,!1)}:a.attachEvent&&(this.addEventHandler=function(a,c,b){a.attachEvent("on"+c,b)});this.addEventHandler(a,c,b)},log:function(a){"undefined"!==typeof console&&"undefined"!==typeof console.log?(this.log=function(a){console.log(a)},this.log.call(this,a)):this.log=function(){}},getWindowSize:function(){var a={width:!1,height:!1};"undefined"!==typeof window.innerWidth?a.width=window.innerWidth:"undefined"!==typeof document.documentElement&&
"undefined"!==typeof document.documentElement.clientWidth?a.width=document.documentElement.clientWidth:"undefined"!==typeof document.body&&(a.width=document.body.clientWidth);"undefined"!==typeof window.innerHeight?a.height=window.innerHeight:"undefined"!==typeof document.documentElement&&"undefined"!==typeof document.documentElement.clientHeight?a.height=document.documentElement.clientHeight:"undefined"!==typeof document.body&&(a.height=document.body.clientHeight);return a},getCSSText:function(a){var c=
"";a.color?a.background=a.cm+"("+a.color[0]+", "+a.color[1]+", "+a.color[2]+")":(a.color=[],a.background=null);a.borderColor?a.borderColorStr=a.cm+"("+a.borderColor[0]+", "+a.borderColor[1]+", "+a.borderColor[2]+")":(a.borderColor=[],a.borderColorStr="");c=b.System.supportedFeatures.csstransforms3d?["-webkit-transform: translateX("+a.x+"px) translateY("+a.y+"px) translateZ(0) rotate("+a.a+"deg) scaleX("+a.s+") scaleY("+a.s+")","-moz-transform: translateX("+a.x+"px) translateY("+a.y+"px) translateZ(0) rotate("+
a.a+"deg) scaleX("+a.s+") scaleY("+a.s+")","-o-transform: translateX("+a.x+"px) translateY("+a.y+"px) translateZ(0) rotate("+a.a+"deg) scaleX("+a.s+") scaleY("+a.s+")","-ms-transform: translateX("+a.x+"px) translateY("+a.y+"px) translateZ(0) rotate("+a.a+"deg) scaleX("+a.s+") scaleY("+a.s+")"].join(";"):b.System.supportedFeatures.csstransforms?["-webkit-transform: translateX("+a.x+"px) translateY("+a.y+"px) rotate("+a.a+"deg) scaleX("+a.s+") scaleY("+a.s+")","-moz-transform: translateX("+a.x+"px) translateY("+
a.y+"px) rotate("+a.a+"deg) scaleX("+a.s+") scaleY("+a.s+")","-o-transform: translateX("+a.x+"px) translateY("+a.y+"px) rotate("+a.a+"deg) scaleX("+a.s+") scaleY("+a.s+")","-ms-transform: translateX("+a.x+"px) translateY("+a.y+"px) rotate("+a.a+"deg) scaleX("+a.s+") scaleY("+a.s+")"].join(";"):["position: absolute","left: "+a.x+"px","top: "+a.y+"px"].join(";");return[c,"opacity: "+a.o,"width: "+a.w+"px","height: "+a.h+"px","background: "+a.background,"z-index: "+a.z,"border-width: "+a.borderWidth+
"px","border-style: "+a.borderStyle,"border-color: "+a.borderColorStr,"border-radius: "+a.borderRadius,"box-shadow: "+a.boxShadow].join(";")}};j.VectorSub=function(a,c){return new j(a.x-c.x,a.y-c.y)};j.VectorAdd=function(a,c){return new j(a.x+c.x,a.y+c.y)};j.VectorMult=function(a,c){return new j(a.x*c,a.y*c)};j.VectorDiv=function(a,c){return new j(a.x/c,a.y/c)};j.VectorDistance=function(a,c){return Math.sqrt(Math.pow(c.x-a.x,2)+Math.pow(c.y-a.y,2))};j.VectorMidPoint=function(a,c){return j.VectorAdd(a,
c).div(2)};j.VectorAngleBetween=function(a,c){var b=a.dot(c);return Math.acos(b/(a.mag()*c.mag()))};j.prototype.name="Vector";j.prototype.clone=function(){function a(){}a.prototype=this;return new a};j.prototype.add=function(a){this.x+=a.x;this.y+=a.y;return this};j.prototype.sub=function(a){this.x-=a.x;this.y-=a.y;return this};j.prototype.mult=function(a){this.x*=a;this.y*=a;return this};j.prototype.div=function(a){this.x/=a;this.y/=a;return this};j.prototype.mag=function(){return Math.sqrt(this.x*
this.x+this.y*this.y)};j.prototype.limit=function(a){this.mag()>a&&(this.normalize(),this.mult(a));return this};j.prototype.limitLow=function(a){this.mag()<a&&(this.normalize(),this.mult(a));return this};j.prototype.normalize=function(){var a=this.mag();if(0!==a)return this.div(a)};j.prototype.distance=function(a){return Math.sqrt(Math.pow(a.x-this.x,2)+Math.pow(a.y-this.y,2))};j.prototype.rotate=function(a){var c=Math.cos(a),a=Math.sin(a),b=this.x,d=this.y;this.x=b*c-d*a;this.y=b*a+d*c;return this};
j.prototype.midpoint=function(a){return j.VectorAdd(this,a).div(2)};j.prototype.dot=function(a){return this.z&&a.z?this.x*a.x+this.y*a.y+this.z*a.z:this.x*a.x+this.y*a.y};b.Vector=j;v.prototype.name="ColorPalette";v.prototype.addColor=function(a){var c,e;if(b.Interface.checkRequiredParams(a,{min:"number",max:"number",startColor:"array",endColor:"array"})){c=b.Utils.getRandomNumber(a.min,a.max);e=v._createColorRange(a.startColor,a.endColor,255);for(a=0;a<c;a++)this._colors.push(e[b.Utils.getRandomNumber(0,
e.length-1)])}return this};v.prototype.createGradient=function(a){if(b.Interface.checkRequiredParams(a,{startColor:"array",endColor:"array"}))if(this.startColor=a.startColor,this.endColor=a.endColor,this.totalColors=a.totalColors||255,0<this.totalColors)this._gradients.push(v._createColorRange(this.startColor,this.endColor,this.totalColors));else throw Error("ColorPalette: total colors must be greater than zero.");};v.prototype.getColor=function(){if(0<this._colors.length)return this._colors[b.Utils.getRandomNumber(0,
this._colors.length-1)];throw Error("ColorPalette.getColor: You must add colors via addColor() before using getColor().");};v.prototype.createSampleStrip=function(a){var c,b,d;c=0;for(b=this._colors.length;c<b;c++)d=document.createElement("div"),d.className="color-sample-strip",d.style.background="rgb("+this._colors[c].toString()+")",a.appendChild(d)};v._createColorRange=function(a,c,b){var d,f=[],g=a[0],h=a[1],a=a[2],i=c[1];d=c[2];var m,j,r,q,c=c[0]-g,i=i-h;m=d-a;for(d=0;d<b;d++)j=parseInt(c*d/b,
10)+g,r=parseInt(i*d/b,10)+h,q=parseInt(m*d/b,10)+a,f.push([j,r,q]);return f};b.ColorPalette=v;A.prototype.addColor=function(a){b.Interface.checkRequiredParams(a,{name:"string",startColor:"array",endColor:"array"})&&(this[a.name]={startColor:a.startColor,endColor:a.endColor});return this};A.prototype.name="ColorTable";A.prototype.getColor=function(a,c,e){var d,f;if("string"===b.Interface.getDataType(a))if(this[a]){a=this[a];c&&(d=a.startColor);e&&(f=a.endColor);if(d&&f||!d&&!f)return{startColor:a.startColor,
endColor:a.endColor};if(d)return d;if(f)return f}else throw Error("ColorTable: "+a+" does not exist. Add colors to the ColorTable via addColor().");else throw Error("ColorTable: You must pass a name (string) for the color entry in the table.");};b.ColorTable=A;B.prototype.name="BorderPalette";B.prototype.addBorder=function(a){var c,e;if(b.Interface.checkRequiredParams(a,{min:"number",max:"number",style:"string"})){e=b.Utils.getRandomNumber(a.min,a.max);for(c=0;c<e;c++)this._borders.push(a.style)}return this};
B.prototype.getBorder=function(){if(0<this._borders.length)return this._borders[b.Utils.getRandomNumber(0,this._borders.length-1)];throw Error("BorderPalette.getBorder: You must add borders via addBorder() before using getBorder().");};b.BorderPalette=B;var z={random:function(){return 0.1}};void 0===z&&(z=Math);var t,V=[];for(t=0;256>t;t+=1)V[t]=Math.floor(256*z.random());z=[];for(t=0;512>t;t+=1)z[t]=V[t&255];b.SimplexNoise={grad3:[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,
0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],p:V,perm:z,simplex:[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],
[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]],dot:function(a,c,b){return a[0]*c+a[1]*b},noise:function(a,c){var b,d,f;f=0.5*(Math.sqrt(3)-1);f*=a+c;var g=Math.floor(a+f),h=Math.floor(c+f),i=(3-Math.sqrt(3))/6;f=(g+h)*i;b=a-(g-f);var m=c-(h-f),j,r;b>m?(j=1,r=0):(j=0,r=1);d=b-j+i;var q=m-r+i;f=b-1+2*i;var i=m-1+2*i,o=g&255,h=h&255,g=this.perm[o+this.perm[h]]%
12;j=this.perm[o+j+this.perm[h+r]]%12;r=this.perm[o+1+this.perm[h+1]]%12;h=0.5-b*b-m*m;0>h?b=0:(h*=h,b=h*h*this.dot(this.grad3[g],b,m));m=0.5-d*d-q*q;0>m?d=0:(m*=m,d=m*m*this.dot(this.grad3[j],d,q));q=0.5-f*f-i*i;0>q?f=0:(q*=q,f=q*q*this.dot(this.grad3[r],f,i));return 70*(b+d+f)},noise3d:function(a,c,b){var d,f,g,h=(a+c+b)*(1/3),i=Math.floor(a+h),j=Math.floor(c+h),k=Math.floor(b+h),h=1/6;g=(i+j+k)*h;d=a-(i-g);f=c-(j-g);var r=b-(k-g),q,o,l,n,u,s;d>=f?f>=r?(q=1,l=o=0,u=n=1,s=0):(d>=r?(q=1,l=o=0):(o=
q=0,l=1),n=1,u=0,s=1):f<r?(o=q=0,l=1,n=0,s=u=1):d<r?(q=0,o=1,n=l=0,s=u=1):(q=0,o=1,l=0,u=n=1,s=0);var p=d-q+h,t=f-o+h,v=r-l+h;g=d-n+2*h;var a=f-u+2*h,y=r-s+2*h,b=d-1+3*h,c=f-1+3*h,h=r-1+3*h,i=i&255,w=j&255,x=k&255,j=this.perm[i+this.perm[w+this.perm[x]]]%12,k=this.perm[i+q+this.perm[w+o+this.perm[x+l]]]%12;n=this.perm[i+n+this.perm[w+u+this.perm[x+s]]]%12;i=this.perm[i+1+this.perm[w+1+this.perm[x+1]]]%12;u=0.6-d*d-f*f-r*r;0>u?d=0:(u*=u,d=u*u*this.dot(this.grad3[j],d,f,r));f=0.6-p*p-t*t-v*v;0>f?f=
0:(f*=f,f=f*f*this.dot(this.grad3[k],p,t,v));p=0.6-g*g-a*a-y*y;0>p?g=0:(p*=p,g=p*p*this.dot(this.grad3[n],g,a,y));a=0.6-b*b-c*c-h*h;0>a?b=0:(a*=a,b=a*a*this.dot(this.grad3[i],b,c,h));return 32*(d+f+g+b)}};b.Interface={checkRequiredParams:function(a,b,e){var d,f,g=!0;for(d in b)if(b.hasOwnProperty(d))try{if("undefined"===typeof a)throw Error("checkRequiredOptions: No options were passed.");if(!this.checkDataType(this.getDataType(a[d]),b[d].split("|"))||""===a[d])throw g=!1,f=""===a[d]?'checkRequiredOptions: required option "'+
d+'" is empty.':"undefined"===typeof a[d]?'checkRequiredOptions: required option "'+d+'" is missing from passed options.':'checkRequiredOptions: passed option "'+d+'" must be type '+b[d]+". Passed as "+this.getDataType(a[d])+".",Error(f);}catch(h){"undefined"!==typeof console&&console.log("ERROR: "+h.message+(e?" from: "+e:""))}return g},checkDataType:function(a,b){var e,d;e=0;for(d=b.length;e<d;e++)if(a===b[e])return!0;return!1},getDataType:function(a){return"[object Array]"===Object.prototype.toString.call(a)?
"array":"[object NodeList]"===Object.prototype.toString.call(a)?"nodeList":typeof a}};k.prototype.name="Universe";k.prototype.addWorld=function(a){this._records.push(new b.World(a||{}));b.elementList.add(this._records[this._records.length-1]);return this._records};k.prototype.first=function(){return this._records[0]?this._records[0]:null};k.prototype.last=function(){return this._records[this._records.length-1]?this._records[this._records.length-1]:null};k.prototype.update=function(a,c){var e,d="object"===
b.Interface.getDataType(a)?a:{},f;if(c)if("string"===b.Interface.getDataType(c))f=this.getWorldById(c);else if("object"===b.Interface.getDataType(c))f=c;else{b.Utils.log("Universe: update: world param must be null, a string (an id) or reference to a world.");return}else f=this.first();for(e in d)d.hasOwnProperty(e)&&(f[e]=d[e]);d.el&&(f.width=parseInt(f.el.style.width.replace("px",""),10),f.height=parseInt(f.el.style.height.replace("px",""),10));b.System.supportedFeatures.touch&&d.isDeviceMotion&&
this.addDeviceMotionEventListener()};k.prototype.all=function(){return this._records};k.prototype.count=function(){return this._records.length};k.prototype.getWorldById=function(a){var b,e,d=this._records;b=0;for(e=d.length;b<e;b+=1)if(d[b].id===a)return d[b];return null};k.prototype.destroyWorld=function(a){var c,e,d=this._records;c=0;for(e=d.length;c<e;c+=1)if(d[c].id===a){a=d[c].el.parentNode;d[c].el===document.body?b.elementList.destroyAll():(b.elementList.destroyByWorld(d[c]),a.removeChild(d[c].el));
d.splice(c,1);break}};k.prototype.clearWorld=function(a){var c,e,d=this._records;c=0;for(e=d.length;c<e;c+=1)if(d[c].id===a)return b.elementList.destroyByWorld(d[c]),!0};k.prototype.destroyAll=function(){b.elementList.destroyAll();for(var a=this._records.length-1;0<=a;a-=1)this.destroyWorld(this._records[a].id)};k.prototype.updateClocks=function(){for(var a=0,b=this._records.length;a<b;a+=1)this._records[a].clock+=1};k.prototype.pauseSystem=function(){(this.isPlaying=!this.isPlaying)&&window.requestAnimFrame(b.animLoop);
return this.isPlaying};k.prototype.resetSystem=function(){var a,c,e;e=this.all();a=0;for(c=e.length;a<c;a+=1)b.elementList.destroyByWorld(e[a]);b.System.setup();this.isPlaying||(this.isPlaying=!0,window.requestAnimFrame(b.animLoop))};k.prototype.toggleStats=function(){this._statsDisplay?this.destroyStats():this.createStats();return this._statsDisplay};k.prototype.createStats=function(){this._statsDisplay=new b.StatsDisplay};k.prototype.destroyStats=function(){var a=document.getElementById("statsDisplay");
this._statsDisplay=null;a&&a.parentNode.removeChild(a)};k.prototype.addDeviceMotionEventListener=function(){var a=this;b.Utils.addEvent(window,"devicemotion",function(b){a.devicemotion.call(a,b)})};k.prototype.devicemotion=function(a){0===window.orientation?this.update({gravity:new b.Vector(a.accelerationIncludingGravity.x,-1*a.accelerationIncludingGravity.y)}):-90===window.orientation?this.update({gravity:new b.Vector(a.accelerationIncludingGravity.y,a.accelerationIncludingGravity.x)}):this.update({gravity:new b.Vector(-1*
a.accelerationIncludingGravity.y,-1*a.accelerationIncludingGravity.x)})};b.Universe=k;s.prototype.name="World";s._idCount=0;s.prototype.configure=function(a){this.el=a||null||document.body;this.el.style.width=this.width+"px";this.el.style.height=this.height+"px"};s.prototype.update=function(a){var c,e,d="",a="object"===b.Interface.getDataType(a)?a:{};for(e in a)a.hasOwnProperty(e)&&(this[e]=a[e]);a.el&&(this.width=parseInt(this.el.style.width.replace("px",""),10),this.height=parseInt(this.el.style.height.replace("px",
""),10));if(this.el.style.setAttribute){if(a.style)for(c in a.style)a.style.hasOwnProperty(c)&&(d=d+c+": "+a.style[c]+";");this.el.style.setAttribute("cssText",d,0)}else if(a.style)for(c in a.style)a.style.hasOwnProperty(c)&&(this.el.style[c]=a.style[c],d=d+c+": "+a.style[c]+";")};s.prototype.resize=function(){var a,c,e;a=b.Utils.getWindowSize();var d=a.width,f=a.height,g=b.elementList.all();a=0;for(c=g.length;a<c;a+=1)if(g[a].controlCamera){e=!0;break}if(!e){a=0;for(c=g.length;a<c;a+=1)e=g[a].location,
e.x=d*(e.x/this.width),e.y=f*(e.y/this.height);this.el===document.body&&(this.width=d,this.height=f,this.el.style.width=this.width+"px",this.el.style.height=this.height+"px")}};s.prototype.step=function(){this.beforeStep&&this.beforeStep.apply(this);this.afterStep&&this.afterStep.apply(this)};s.prototype.draw=function(){if(b.camera.controlObj||!(this.isStatic&&0<this.clock))this.el.style.cssText=b.Utils.getCSSText({x:this.location.x,y:this.location.y,s:this.scale,a:this.angle,o:this.opacity,w:this.width,
h:this.height,cm:this.colorMode,color:this.color,z:this.zIndex,borderWidth:this.borderWidth,borderStyle:this.borderStyle,borderColor:this.borderColor,borderRadius:this.borderRadius,boxShadow:this.boxShadow})};b.World=s;W.prototype.name="Camera";b.Camera=W;n._idCount=0;n.events=["mouseenter","mousedown","mousemove","mouseup","mouseleave"];n.prototype.name="Element";n.mouseover=function(){this.isMouseOut=!1;clearInterval(this.mouseOutInterval)};n.mousedown=function(a){var b=a.target;this.isPressed=
!0;this.isMouseOut=!1;this.offsetX=a.pageX-b.offsetLeft;this.offsetY=a.pageY-b.offsetTop};n.mousemove=function(a){var c;this.isPressed&&(this.isMouseOut=!1,c=a.pageX-this.world.el.offsetLeft,a=a.pageY-this.world.el.offsetTop,n.mouseIsInsideWorld(this.world)?this.location=new b.Vector(c,a):this.isPressed=!1)};n.mouseup=function(){this.isPressed=!1};n.mouseout=function(){var a=this,c,e;this.isPressed&&(this.isMouseOut=!0,this.mouseOutInterval=setInterval(function(){a.isPressed&&a.isMouseOut&&(c=b.mouse.loc.x-
a.world.el.offsetLeft,e=b.mouse.loc.y-a.world.el.offsetTop,a.location=new b.Vector(c,e))},16))};n.mouseIsInsideWorld=function(a){var c=b.mouse.loc.x,e=b.mouse.loc.y;return a&&c>a.location.x&&c<a.location.x+a.width&&e>a.location.y&&e<a.location.y+a.height?!0:!1};n.prototype.step=function(){};n.prototype.draw=function(){this.el.style.cssText=b.Utils.getCSSText({x:this.location.x-this.width/2,y:this.location.y-this.height/2,s:this.scale,a:this.angle,o:this.opacity,w:this.width,h:this.height,cm:this.colorMode,
color:this.color,z:this.zIndex,borderWidth:this.borderWidth,borderStyle:this.borderStyle,borderColor:this.borderColor,borderRadius:this.borderRadius,boxShadow:this.boxShadow})};b.Element=n;b.Utils.extend(l,b.Element);l.prototype.name="Agent";l.prototype.step=function(){var a,c,e,d,f,g,h,i=this.world,j=b.elementList.all();this.beforeStep&&this.beforeStep.apply(this);if(!this.isStatic&&!this.isPressed){if(0<b.liquids.length){a=0;for(c=b.liquids.length;a<c;a+=1)this.id!==b.liquids[a].id&&this.isInside(b.liquids[a])&&
(e=this.drag(b.liquids[a]),this.applyForce(e),e=b.liquids[a].className+" activated",b.liquids[a].el.className=e)}if(0<b.repellers.length){a=0;for(c=b.repellers.length;a<c;a+=1)this.id!==b.repellers[a].id&&(e=this.attract(b.repellers[a]),this.applyForce(e))}if(0<b.attractors.length){a=0;for(c=b.attractors.length;a<c;a+=1)this.id!==b.attractors[a].id&&(e=this.attract(b.attractors[a]),this.applyForce(e))}if(0<this.sensors.length){a=0;for(c=this.sensors.length;a<c;a+=1)g=this.sensors[a],d=g.offsetDistance,
f=b.Utils.degreesToRadians(this.angle+g.offsetAngle),e=d*Math.cos(f),d*=Math.sin(f),g.location.x=this.location.x,g.location.y=this.location.y,g.location.add(new b.Vector(e,d)),g.activated&&(this.applyForce(g.getActivationForce({agent:this})),h=!0)}!h&&this.motorSpeed&&(a=b.Utils.clone(this.velocity),a.normalize(),this.velocity.mag()>this.motorSpeed?a.mult(-this.motorSpeed):a.mult(this.motorSpeed),this.applyForce(a));i.c&&(a=b.Utils.clone(this.velocity),a.mult(-1),a.normalize(),a.mult(i.c),this.applyForce(a));
this.applyForce(i.wind);this.applyForce(i.gravity);this.followMouse&&(a={location:new b.Vector(b.mouse.loc.x,b.mouse.loc.y)},this.applyForce(this.seek(a)));this.seekTarget&&this.applyForce(this.seek(this.seekTarget));this.flowField&&(c=this.flowField.resolution,a=Math.floor(this.location.x/c),c=Math.floor(this.location.y/c),this.flowField.field[a]&&(a=(a=this.flowField.field[a][c])?{location:new b.Vector(a.x,a.y)}:{location:new b.Vector(this.location.x,this.location.y)},this.applyForce(this.follow(a))));
this.flocking&&this.flock(j);this.velocity.add(this.acceleration);this.maxSpeed&&this.velocity.limit(this.maxSpeed);this.minSpeed&&this.velocity.limitLow(this.minSpeed);this.location.add(this.velocity);this.pointToDirection&&0.1<this.velocity.mag()&&(this.angle=b.Utils.radiansToDegrees(Math.atan2(this.velocity.y,this.velocity.x)));this.controlCamera&&this.checkCameraEdges();(this.checkEdges||this.wrapEdges)&&this.checkWorldEdges(i);this.parent&&(this.offsetDistance?(d=this.offsetDistance,f=b.Utils.degreesToRadians(this.parent.angle+
this.offsetAngle),e=d*Math.cos(f),d*=Math.sin(f),this.location.x=this.parent.location.x,this.location.y=this.parent.location.y,this.location.add(new b.Vector(e,d))):this.location=this.parent.location);this.afterStep&&this.afterStep.apply(this);this.acceleration.mult(0);0<this.lifespan&&(this.lifespan-=1)}};l.prototype.applyForce=function(a){a=a.clone();a.div(this.mass);this.acceleration.add(a)};l.prototype.seek=function(a){var c=this.world,a=b.Vector.VectorSub(a.location,this.location),e=a.mag();
a.normalize();e<c.width/2?(c=b.Utils.map(e,0,c.width/2,0,this.maxSpeed),a.mult(c)):a.mult(this.maxSpeed);c=b.Vector.VectorSub(a,this.velocity);c.limit(this.maxSteeringForce);return c};l.prototype.follow=function(a){a=a.location.clone();a.mult(this.maxSpeed);a=b.Vector.VectorSub(a,this.velocity);a.limit(this.maxSteeringForce);return a};l.prototype.flock=function(a){this.applyForce(this.separate(a).mult(this.separateStrength));this.applyForce(this.align(a).mult(this.alignStrength));this.applyForce(this.cohesion(a).mult(this.cohesionStrength))};
l.prototype.separate=function(a){var c,e,d,f,g=new b.Vector,h=0;c=0;for(e=a.length;c<e;c+=1)d=a[c],this.className===d.className&&this.id!==d.id&&(f=this.location.distance(d.location),0<f&&f<this.desiredSeparation&&(d=b.Vector.VectorSub(this.location,d.location),d.normalize(),d.div(f),g.add(d),h+=1));return 0<h?(g.div(h),g.normalize(),g.mult(this.maxSpeed),a=b.Vector.VectorSub(g,this.velocity),a.limit(this.maxSteeringForce),a):new b.Vector};l.prototype.align=function(a){var c,e,d,f,g=new b.Vector,
h=2*this.width,i=0;c=0;for(e=a.length;c<e;c+=1)d=a[c],f=this.location.distance(d.location),0<f&&f<h&&(this.className===d.className&&this.id!==d.id)&&(g.add(d.velocity),i+=1);return 0<i?(g.div(i),g.normalize(),g.mult(this.maxSpeed),a=b.Vector.VectorSub(g,this.velocity),a.limit(this.maxSteeringForce),a):new b.Vector};l.prototype.cohesion=function(a){var c,e,d,f,g=new b.Vector,h=0;c=0;for(e=a.length;c<e;c+=1)d=a[c],f=this.location.distance(d.location),0<f&&10>f&&(this.className===d.className&&this.id!==
d.id)&&(g.add(d.location),h+=1);return 0<h?(g.div(h),a=b.Vector.VectorSub(g,this.location),a.normalize(),a.mult(this.maxSpeed),a=b.Vector.VectorSub(a,this.velocity),a.limit(this.maxSteeringForce),a):new b.Vector};l.prototype.flee=function(a){a=b.Vector.VectorSub(a.location,this.location);a.normalize();a.mult(-this.maxSpeed);return a};l.prototype.drag=function(a){var c=this.velocity.mag(),a=-1*a.c*c*c,c=b.Utils.clone(this.velocity);c.normalize();c.mult(a);return c};l.prototype.attract=function(a){var c=
b.Vector.VectorSub(a.location,this.location),e;e=c.mag();e=b.Utils.constrain(e,this.width*this.height/8,a.width*a.height);c.normalize();c.mult(a.G*a.mass*this.mass/(e*e));return c};l.prototype.isInside=function(a){return a&&this.location.x+this.width/2>a.location.x-a.width/2&&this.location.x-this.width/2<a.location.x+a.width/2&&this.location.y+this.height/2>a.location.y-a.height/2&&this.location.y-this.height/2<a.location.y+a.height/2?!0:!1};l.prototype.checkWorldEdges=function(a){var c=this.location.x,
e=this.location.y,d,f=!1,g;this.wrapEdges?this.location.x>a.width?(this.location=new b.Vector(0,this.location.y),g=new b.Vector(c-this.location.x,0),f=!0):0>this.location.x&&(this.location=new b.Vector(a.width,this.location.y),g=new b.Vector(c-this.location.x,0),f=!0):(this.avoidEdges&&(this.location.x<this.avoidEdgesStrength?d=this.maxSpeed:this.location.x>b.world.width-this.avoidEdgesStrength&&(d=-this.maxSpeed),d&&(d=new b.Vector(d,this.velocity.y),d=b.Vector.VectorSub(d,this.velocity),d.limit(this.maxSteeringForce),
this.applyForce(d))),this.location.x+this.width/2>a.width)?(this.location=new b.Vector(a.width-this.width/2,this.location.y),g=new b.Vector(c-this.location.x,0),this.velocity.x*=-1*this.bounciness,f=!0):this.location.x<this.width/2&&(this.location=new b.Vector(this.width/2,this.location.y),g=new b.Vector(c-this.location.x,0),this.velocity.x*=-1*this.bounciness,f=!0);d=null;this.wrapEdges?this.location.y>a.height?(this.location=new b.Vector(this.location.x,0),g=new b.Vector(0,e-this.location.y),f=
!0):0>this.location.y&&(this.location=new b.Vector(this.location.x,a.height),g=new b.Vector(0,e-this.location.y),f=!0):(this.avoidEdges&&(this.location.y<this.avoidEdgesStrength?d=this.maxSpeed:this.location.y>b.world.height-this.avoidEdgesStrength&&(d=-this.maxSpeed),d&&(d=new b.Vector(this.velocity.x,d),d=b.Vector.VectorSub(d,this.velocity),d.limit(this.maxSteeringForce),this.applyForce(d))),this.location.y+this.height/2>a.height)?(this.location=new b.Vector(this.location.x,a.height-this.height/
2),g=new b.Vector(0,e-this.location.y),this.velocity.y*=-1*this.bounciness,f=!0):this.location.y<this.height/2&&(this.location=new b.Vector(this.location.x,this.height/2),g=new b.Vector(0,e-this.location.y),this.velocity.y*=-1*this.bounciness,f=!0);f&&this.controlCamera&&a.location.add(g);return f};l.prototype.checkCameraEdges=function(){var a=this.velocity.clone();this.world.location.add(a.mult(-1))};l.prototype.getLocation=function(a){if(a){if("x"===a)return this.location.x;if("y"===a)return this.location.y}else return new b.Vector(this.location.x,
this.location.y)};l.prototype.getVelocity=function(a){if(a){if("x"===a)return this.velocity.x;if("y"===a)return this.velocity.y}else return new b.Vector(this.velocity.x,this.velocity.y)};b.Agent=l;b.Utils.extend(C,b.Agent);C.prototype.name="Walker";C.prototype.step=function(){var a=this.world,c;this.beforeStep&&this.beforeStep.apply(this);!this.isStatic&&!this.isPressed&&(this.isPerlin?(this.perlinTime+=this.perlinSpeed,this.remainsOnScreen?(this.acceleration=new b.Vector,this.velocity=new b.Vector.create,
this.location.x=b.Utils.map(b.SimplexNoise.noise(this.perlinTime+this.offsetX,0,0.1),-1,1,0,b.world.width),this.location.y=b.Utils.map(b.SimplexNoise.noise(0,this.perlinTime+this.offsetY,0.1),-1,1,0,b.world.height)):(this.acceleration.x=b.Utils.map(b.SimplexNoise.noise(this.perlinTime+this.offsetX,0,0.1),-1,1,this.perlinAccelLow,this.perlinAccelHigh),this.acceleration.y=b.Utils.map(b.SimplexNoise.noise(0,this.perlinTime+this.offsetY,0.1),-1,1,this.perlinAccelLow,this.perlinAccelHigh))):(a.c&&(c=b.Utils.clone(this.velocity),
c.mult(-1),c.normalize(),c.mult(a.c),this.applyForce(c)),this.applyForce(a.wind),this.applyForce(a.gravity)),this.isHarmonic&&(this.velocity.x=this.harmonicAmplitude.x*Math.cos(2*Math.PI*b.world.clock/this.harmonicPeriod.x),this.velocity.y=this.harmonicAmplitude.y*Math.cos(2*Math.PI*b.world.clock/this.harmonicPeriod.y)),this.isRandom&&(this.target={location:b.Vector.VectorAdd(this.location,new b.Vector(b.Utils.getRandomNumber(-this.randomRadius,this.randomRadius),b.Utils.getRandomNumber(-this.randomRadius,
this.randomRadius)))}),this.seekTarget&&this.applyForce(this.seek(this.seekTarget)),this.velocity.add(this.acceleration),this.maxSpeed&&this.velocity.limit(this.maxSpeed),this.location.add(this.velocity),this.pointToDirection&&0.1<this.velocity.mag()&&(this.angle=b.Utils.radiansToDegrees(Math.atan2(this.velocity.y,this.velocity.x))),this.controlCamera&&this.checkCameraEdges(),(this.checkEdges||this.wrapEdges)&&this.checkWorldEdges(a),0<this.lifespan&&(this.lifespan-=1),this.afterStep&&this.afterStep.apply(this),
this.acceleration.mult(0))};b.Walker=C;b.Utils.extend(D,b.Agent);D.prototype.name="Oscillator";D.prototype.step=function(){var a=this.world,c;this.beforeStep&&this.beforeStep.apply(this);if(!this.isStatic&&!this.isPressed&&(this.isPerlin?(this.perlinTime+=this.perlinSpeed,this.aVelocity.x=b.Utils.map(b.SimplexNoise.noise(this.perlinTime+this.perlinOffsetX,0,0.1),-1,1,this.perlinAccelLow,this.perlinAccelHigh),this.aVelocity.y=b.Utils.map(b.SimplexNoise.noise(0,this.perlinTime+this.perlinOffsetY,0.1),
-1,1,this.perlinAccelLow,this.perlinAccelHigh)):this.aVelocity.add(this.acceleration),this.location.x=this.initialLocation.x+Math.sin(this.aVelocity.x)*this.amplitude.x,this.location.y=this.initialLocation.y+Math.sin(this.aVelocity.y)*this.amplitude.y,this.pointToDirection&&(c=b.Vector.VectorSub(this.location,this.lastLocation),this.angle=b.Utils.radiansToDegrees(Math.atan2(c.y,c.x))),this.controlCamera&&this.checkCameraEdges(),(this.checkEdges||this.wrapEdges)&&this.checkWorldEdges(a),0<this.lifespan&&
(this.lifespan-=1),this.afterStep&&this.afterStep.apply(this),this.pointToDirection))this.lastLocation.x=this.location.x,this.lastLocation.y=this.location.y};b.Oscillator=D;b.Utils.extend(E,b.Agent);E.prototype.name="Particle";E.prototype.step=function(){var a=this.world,c;this.beforeStep&&this.beforeStep.apply(this);!this.isStatic&&!this.isPressed&&(a.c&&(c=b.Utils.clone(this.velocity),c.mult(-1),c.normalize(),c.mult(a.c),this.applyForce(c)),this.applyForce(a.wind),this.applyForce(a.gravity),(this.checkEdges||
this.wrapEdges)&&this.checkWorldEdges(a),this.velocity.add(this.acceleration),this.maxSpeed&&this.velocity.limit(this.maxSpeed),this.location.add(this.velocity),this.opacity=b.Utils.map(this.lifespan,0,this.maxSpeed,0,1),this.afterStep&&this.afterStep.apply(this),0<this.lifespan?this.lifespan-=1:0===this.lifespan&&b.elementList.destroyElement(this.id),this.acceleration.mult(0))};b.Particle=E;b.Utils.extend(H,b.Agent);H.prototype.name="ParticleSystem";b.ParticleSystem=H;b.Utils.extend(I,b.Agent);I.prototype.name=
"Liquid";b.Liquid=I;b.Utils.extend(J,b.Agent);J.prototype.name="Attractor";b.Attractor=J;b.Utils.extend(K,b.Agent);K.prototype.name="Repeller";b.Repeller=K;b.Utils.extend(L,b.Agent);L.prototype.name="Heat";b.Heat=L;b.Utils.extend(M,b.Agent);M.prototype.name="Cold";b.Cold=M;b.Utils.extend(N,b.Agent);N.prototype.name="Light";b.Light=N;b.Utils.extend(O,b.Agent);O.prototype.name="Oxygen";b.Oxygen=O;b.Utils.extend(P,b.Agent);P.prototype.name="Food";b.Food=P;b.Utils.extend(Q,b.Agent);Q.prototype.name="Predator";
b.Predator=Q;b.Utils.extend(w,b.Agent);w.prototype.name="Sensor";w.prototype.step=function(){var a=!1,c,e;if("heat"===this.type&&0<b.heats.length){c=0;for(e=b.heats.length;c<e;c+=1)this.isInside(this,b.heats[c],this.sensitivity)&&(this.target=b.heats[c],a=this.activated=!0)}else if("cold"===this.type&&0<b.colds.length){c=0;for(e=b.colds.length;c<e;c+=1)this.isInside(this,b.colds[c],this.sensitivity)&&(this.target=b.colds[c],a=this.activated=!0)}else if("predator"===this.type&&0<b.predators.length){c=
0;for(e=b.predators.length;c<e;c+=1)this.isInside(this,b.predators[c],this.sensitivity)&&(this.target=b.predators[c],a=this.activated=!0)}else if("light"===this.type&&0<b.lights.length){c=0;for(e=b.lights.length;c<e;c+=1)this.isInside(this,b.lights[c],this.sensitivity)&&(this.target=b.lights[c],a=this.activated=!0)}else if("oxygen"===this.type&&0<b.oxygen.length){c=0;for(e=b.oxygen.length;c<e;c+=1)this.isInside(this,b.oxygen[c],this.sensitivity)&&(this.target=b.oxygen[c],a=this.activated=!0)}else if("food"===
this.type&&0<b.food.length){c=0;for(e=b.food.length;c<e;c+=1)this.isInside(this,b.food[c],this.sensitivity)&&(this.target=b.food[c],a=this.activated=!0)}a?this.color=this.activatedColor:(this.target=null,this.activated=!1,this.color="transparent");this.afterStep&&this.afterStep.apply(this)};w.prototype.getActivationForce=function(a){var c;switch(this.behavior){case "AGGRESSIVE":return this.seek(this.target);case "COWARD":return this.seek(this.target).mult(-1);case "LIKES":var e=b.Vector.VectorSub(this.target.location,
this.location);c=e.mag();e.normalize();c/=a.agent.maxSpeed;e.mult(c);c=b.Vector.VectorSub(e,a.agent.velocity);c.limit(0.01*a.agent.maxSteeringForce);return c;case "LOVES":e=b.Vector.VectorSub(this.target.location,this.location);c=e.mag();e.normalize();if(c>this.width)return c/=a.agent.maxSpeed,e.mult(c),c=b.Vector.VectorSub(e,a.agent.velocity),c.limit(a.agent.maxSteeringForce),c;a.agent.velocity=new b.Vector;a.agent.acceleration=new b.Vector;return new b.Vector;case "EXPLORER":return e=b.Vector.VectorSub(this.target.location,
this.location),c=e.mag(),e.normalize(),c/=a.agent.maxSpeed,e.mult(-c),c=b.Vector.VectorSub(e,a.agent.velocity),c.limit(0.01*a.agent.maxSteeringForce),c;case "RUN":return this.flee(this.target);case "ACCELERATE":return c=a.agent.velocity.clone(),c.normalize(),c.mult(a.agent.minSpeed);case "DECELERATE":return c=a.agent.velocity.clone(),c.normalize(),c.mult(-a.agent.minSpeed);default:return new b.Vector}};w.prototype.isInside=function(a,b,e){return a.location.x+a.width/2>b.location.x-b.width/2-e*b.width&&
a.location.x-a.width/2<b.location.x+b.width/2+e*b.width&&a.location.y+a.height/2>b.location.y-b.height/2-e*b.height&&a.location.y-a.height/2<b.location.y+b.height/2+e*b.height?!0:!1};b.Sensor=w;X.prototype.name="FlowFieldMarker";b.FlowFieldMarker=X;R.prototype.name="FlowField";R.prototype.build=function(){var a,c,e,d,f,g,h,i,j={},k=this.world,l=Math.ceil(k.width/parseFloat(this.resolution)),n=Math.ceil(k.height/parseFloat(this.resolution)),o=this.perlinTime,p;for(a=0;a<l;a+=1){p=this.perlinTime;j[a]=
{};c=0;for(e=n;c<e;c+=1)d=a*this.resolution+this.resolution/2,f=c*this.resolution+this.resolution/2,g=b.Utils.map(b.SimplexNoise.noise(o,p,0.1),0,1,0,2*Math.PI),h=Math.cos(g),i=Math.sin(g),g=new b.Vector(h,i),j[a][c]=g,h=b.Utils.radiansToDegrees(Math.atan2(i,h)),this.createMarkers&&(d=new b.FlowFieldMarker({location:new b.Vector(d,f),scale:1,opacity:b.Utils.map(h,-360,360,0.1,1),width:this.resolution,height:this.resolution/2,field:g,angle:h,colorMode:"rgb",color:[200,100,50]}),k.el.appendChild(d)),
p+=parseFloat(this.perlinSpeed);o+=parseFloat(this.perlinSpeed)}this.field=j};b.FlowField=R;b.Utils.extend(F,b.Agent);F.prototype.name="Connector";F.prototype.step=function(){var a=this.parentA.location,c=this.parentB.location;this.width=Math.floor(b.Vector.VectorSub(this.parentA.location,this.parentB.location).mag());this.location=b.Vector.VectorAdd(this.parentA.location,this.parentB.location).div(2);this.angle=b.Utils.radiansToDegrees(Math.atan2(c.y-a.y,c.x-a.x))};b.Connector=F;b.Utils.extend(S,
b.Agent);S.prototype.name="Point";b.Point=S;T.prototype.name="Caption";T.prototype.destroy=function(){this._el.parentNode.removeChild(this._el)};b.Caption=T;U.prototype.name="InputMenu";U.prototype.destroy=function(){this._el.parentNode.removeChild(this._el)};b.InputMenu=U;G.prototype.getFPS=function(){return this._fps};G.prototype._update=function(){var a=b.elementList.count();this._time=Date.now?Date.now():0;this._frameCount++;this._time>this._timeLastSecond+1E3&&(this._fps=this._frameCount,this._timeLastSecond=
this._time,this._frameCount=0,this._fpsValue.nodeValue=this._fps,this._totalElementsValue.nodeValue=a);window.requestAnimFrame(this._update.bind(this))};G.prototype.name="StatsDisplay";b.StatsDisplay=G;x.prototype.name="FeatureDetector";x.prototype.detect=function(a){return!this[a]?!1:this[a].call(this)};x.prototype.csstransforms=function(){var a=document.createDocumentFragment(),b=document.createElement("div");a.appendChild(b);b.style.cssText="-webkit-transform: translateX(1px) translateY(1px);-moz-transform: translateX(1px) translateY(1px);-o-transform: translateX(1px) translateY(1px);-ms-transform: translateX(1px) translateY(1px)";
for(var a=[b.style.transform,b.style.webkitTransform,b.style.MozTransform,b.style.OTransform,b.style.msTransform],b=!1,e=0;e<a.length;e+=1)if(a[e]){b=!0;break}return b};x.prototype.csstransforms3d=function(){var a=document.createDocumentFragment(),b=document.createElement("div");a.appendChild(b);b.style.cssText="-webkit-transform: translateX(1px) translateY(1px) translateZ(0);-moz-transform: translateX(1px) translateY(1px) translateZ(0);-o-transform: translateX(1px) translateY(1px) translateZ(0);-ms-transform: translateX(1px) translateY(1px) translateZ(0)";
for(var a=[b.style.transform,b.style.webkitTransform,b.style.MozTransform,b.style.OTransform,b.style.msTransform],b=!1,e=0;e<a.length;e+=1)if(a[e]){b=!0;break}return b};x.prototype.touch=function(){var a=document.createElement("div");a.setAttribute("ongesturestart","return;");return"function"===typeof a.ongesturestart?!0:!1};b.FeatureDetector=x})(exports);

